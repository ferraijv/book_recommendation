{% if all_book_metadata %}
<div class="book-grid">
    {% for book in all_book_metadata %}
    <div class="book-card">
        <div class="book-header">
            {% if book.amazon_link %}
                <a href="{{ book.amazon_link }}" target="_blank" rel="noopener" data-ga-event="{{ book.ga_event }}">
                    <h3>{{ book.title }}</h3>
                </a>
            {% else %}
                <h3>{{ book.title }}</h3>
            {% endif %}

            {% if book.thumbnail %}
                <div class="book-thumbnail">
                    {% if book.amazon_link %}
                        <a href="{{ book.amazon_link }}" target="_blank" rel="noopener" data-ga-event="{{ book.ga_event }}">
                            <img src="{{ book.thumbnail }}" alt="Book cover for {{ book.title }}">
                        </a>
                    {% else %}
                        <img src="{{ book.thumbnail }}" alt="Book cover for {{ book.title }}">
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <p><strong>Authors:</strong> {{ book.authors[0] if book.authors else "N/A" }}</p>
        <p class="book-description">
            {% if book.description %}
                {{ book.description[:200] }}
                {% if book.description|length > 200 %}
                    <span class="ellipsis">...</span>
                    <span class="more-text" style="display: none;"> {{ book.description[200:] }}</span>
                    <a href="javascript:void(0);" class="see-more" onclick="toggleDescription(this)">See More</a>
                {% endif %}
            {% else %}
                <span>No description available.</span>
            {% endif %}
        </p>
        <p class="book-description">
            {% if book.reason %}
                <strong>Why we picked it:</strong> {{ book.reason[:200] }}
                {% if book.reason|length > 200 %}
                    <span class="ellipsis">...</span>
                    <span class="more-text" style="display: none;">{{ book.reason[200:] }}</span>
                    <a href="javascript:void(0);" class="see-more" onclick="toggleDescription(this)">See More</a>
                {% endif %}
            {% else %}
                <span>No reason available.</span>
            {% endif %}
        </p>
        <p><strong>Categories:</strong> {{ book.categories | join(", ") if book.categories else "N/A" }}</p>
        <p><strong>Published Date:</strong> {{ book.publishedDate or "N/A" }}</p>
        <p><strong>Page Count:</strong> {{ book.pageCount or "N/A" }}</p>

        {% if book.amazon_link %}
            <div class="description-toggle">
                <a href="{{ book.amazon_link }}" target="_blank" rel="noopener" class="nav-cta" style="display: inline-block; text-align: center;">View on Amazon</a>
            </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
